# 운영체제

---

### 운영체제란?

- 운영체제는 사용자의 하드웨어를 제어하고 프로그램에 대한 일반적 서비스를 지원하는 시스템 소프트웨어
- 운영체제는 컴퓨터 하드웨어가 컴퓨터 소프트웨어와 통신하고 작동하도록 하는 소프트웨어 프로그램

### 운영체제 구조

- 운영체제 구성은 유저 영역과 커널 영역 두 가지로 나뉜다.
- 커널은 운영체제의 핵심 부분으로, 자원할당, 네트워크 관리 등 모든 부분에 대한 기본 서비스를 제공하는 가장 중요한 부분이다.

### 메모리 구조

- 메모리 구조는 코드, 데이터, 힙, 스택 4가지 영역으로 나누어져 있으며 이들 각각을 세그먼드라고 한다. 코드, 데이터 영역은 정적 세그먼트 힙과 스택은 동적 세그먼트
    
    
    - code 영역 : 실행할 프로그램의 코드가 저장되는 텍스트 영역
    - data 영역 : 프로그램의 전역 변수와 정적 변수가 저장되는 영역
    - heap 영역 : 사용자가 직접 관리할 수 있는 메모리 영역으로, 사용자에 의해 메모리 공간이 동적으로 할당되고 해제
    - stack 영역 : 함수의 호출과 관계되는 지역변수와 매개변수가 저장되는 영역, 함수의 호출과 함께 할당되며, 함수의 호출이 종료될 때 해제

### 프로세스란?

- 정의
    - 프로세스는 컴퓨터에서 실행되고 있는 프로그램
- 특징
    - 운영체제로부터 독립된 메모리 영역을 할당
    - 프로세스들은 독립적이므로 통신을 위해 IPC를 사용해야 함
    - 프로세스마다 최소 1개의 쓰레드를 소유

### 프로그램과 프로세스 차이

- 프로그램은 명령어 리스트를 내용으로 가진 저장된 코드, 파일이고, 프로세스는 프로그램의 상태가 메모리 상에서 실행되는 작업 단위

### 프로세스 스케줄링

- 커널 내에는 준비 큐, 대기 큐, 실행 큐 등의 자료 구조가 있으며 커널은 이것들을 이용하여 프로세스의 상태를 관리

- 생성 : 프로세스 생성
- 준비 :  프로세스가 CPU를 사용하고 있지는 않지만 언제든지 사용할 수 있는 상태로, CPU 할당을 기다리는 상태, 일반적으로 우선순위가 높은 프로세스부터 할당
- 실행 : 프로세스가 CPU를 차지하여 명령어들이 실행
- 대기 : 보류라고 부르기도 하며 프로세스가 입출력 완료, 시그널 수신 등 어떤 사건을 기다리는 상태
- 종료 : 프로세스의 실행이 종료

### 멀티 프로세스란?

- 정의
    - 멀티 프로세스는 두개 이상의 다수의 프로세서가 협력하여 하나 이상의 작업을 병렬적으로 처리하는 것
    - 각 프로세스 간 메모리 구분이 필요하거나 독립된 주소 공간을 가져야 할 경우 사용
- 장점
    - 독립된 구조로 안정성이 높은 장점
    - 프로세스 중 하나에 문제가 생겨도 다른 프로세스에 영향을 주지 않아 속도는 느려질 수 있으나 정지되는 문제는 발생하지 않음
    - 여러 개의 프로세스가 처리되는 동안 동일 데이터를 사용하고 데이터를 하나의 디스크에 두고 공유하면 비용적으로 저렴
- 문제점
    - 독립된 메모리 영역이기 때문에 작업량이 많을수록 컨텍스트 스위칭이 자주 일어나서 오버헤드가 발생하여 성능저하가 발생 할 수 있음
    - 컨텍스트 스위칭 과정에서 캐시 메모리 초기화 등 무거운 작업이 진행되고 시간이 소모되는 오버헤드 발생

### 컨텍스트 스위칭 (Context Switching) 이란?

- 멀티프로세스 환경에서 CPU가 어떤 하나의 프로세스를 실행하고 있는 상태에서 인터럽트 요청에 의해 다음 우선 순위의 프로세스가 실행되어야 할 때 기존의 프로세스의 상태를 저장하고 CPU가 다음 프로세스를 수행하도록 새로운 프로세스 상태로 교체하는 작업

### 쓰레드란?

- 정의
    - CPU, 프로세서 사용의 기본 단위
    - 프로세스 내에서 할당받은 자원을 이용해 동작하는 실행 단위
- 특징
    - 쓰레드는 프로세스 내에서 Stack만 따로 할당 받고, Code, Data, Heap 영역을 공유
    - 프로세스 자원을 공유하므로 다른 쓰레드에 의한 결과를 즉시 확인 가능
    - 프로세스 내에 존재하며 프로세스가 할당받은 자원을 이용하여 실행
- 장점
    1. 응답성 : 하나의 쓰레드가 blocked 상태인 동안에도 다른 쓰레드는 running이 되어 빠른 응답성
    2. 자원 공유 :  스레드는 프로세스 내의 각종 자원들을 공유하여 동작
    3. 경제적 : 프로세스 생성보다 쓰레드 생성이 더욱 쉽고, 컨텍스트 스위칭시 비용이 적음
    4. 병렬성 : 동일한 일을 수행하는 다중 스레드가 협력하여 높은 처리률과 성능향상

### 멀티 쓰레드란?

- 정의
    - 다수의 쓰레드를 이용하여 하나의 프로그램을 동시에 처리하는 것
    - 하나의 프로그램을 위하여 다수의 실행 단위를 이용한다는 점에서 멀티 프로세싱과 비슷한 의미
- 장점
    - 메모리가 독립적인 프로세스에 비해 공유 메모리만큼의 시간, 자원 손실이 감소
    - 전역 변수와 정적 변수에  대한 자료 공유 가능
- 유의점
    - 다수의 쓰레드가 공유 데이터에 동시에 접근하는 경우 상호 배제 또는 동기화 기법을 통해서 동시성 문제 또는 데드락이 발생하지 않도록 주의
    

### IPC란?

- 독립적으로 실행되는 프로세스간의 통신을 가능하도록 해주는 것이 IPC 통신
- 커널이 제공하는 IPC 설비를 이용해 프로세스간 통신

### IPC 종류

1. 익명 PIPE
    - 파이프는 두 개의 프로세스를 연결하고, 하나의 프로세스는 데이터 쓰기만, 다른 하나는 데이터 읽기만 가능
    - 단 방향 통신이 가능한 구조,  이러한 특징으로 반이중통신이라고 부름
    - 단순한 데이터 흐름을 가질 땐 파이프를 사용하는 것이 효율적
    - 파이프의 읽기/쓰기가 모두 가능하려면 두 개의 파이프를 연결해야 하므로 구현이 복잡하다는 단점
    
2. Named PIPE
    - 익명의 파이프와 달리 전혀 모르는 상태의 프로세스들 사이 통신에 사용
    - 익명 파이프의 확장된 상태로 부모 프로세스와 무관한 다른 프로세스도 통신이 가능
    
3. Message Queue
    - 큐 자료구조를 사용하며 입출력 방식은 PIPE와 동일
    - 메세지 큐는 메모리 공간을 할당 받아 사용, 이 공간은 컨테이너 벨트라고도 함
    - 메세지 큐에 쓸 데이터에 번호를 붙임으로써 여러 개의 프로세스가 동시에 데이터를 쉽게 다룰 수 있음
    
4. 공유 메모리
    - 공유 메모리는 데이터 자체를 공유하도록 지원하는 설비
    - 공유 메모리는 프로세스간 메모리 영역을 공유해서 사용할 수 있도록 허용
    - 공유 메모리는 중개자 없이 곧바로 메모리에 접근이 가능하여 다른 모든 IPC 중 가장 빠르게 작동
    
5. 메모리 맵
    - 메모리 맵은 열린 파일을 메모리에 매핑시켜서 공유하는 방식
    - 대용량 데이터를 공유해야할 때 사용
    
6. 소켓
    - 네트워크 소켓 통신을 통해 데이터를 공유
    - 클라이언트와 서버가 소켓을 통해서 통신하는 구조로, 원격에서 프로세스간 데이터를 공유할 때 사용

### CPU 스케줄링이란?

- CPU가 처리할 일들의 진행순서를 정하는 일
- 처리율과 CPU 이용률을 증가시키고, 오버헤드, 응답시간, 반환시간, 대기시간을 최소화하기 위한 기법
- 스케줄링 전략에는 선점과 비선점 두가지

### CPU 스케줄링은 언제 발생하는지?

- 실행상태에서 대기상태로 전환될 때 (예, 입출력 요청)
- 실행상태에서 준비상태로 전환될 때 (예, 인터럽트 발생)
- 대기상태에서 준비상태로 전환될 때(예, 입출력이 종료될 때)
- 종료될 때(Terminated)

### 비선점 스케줄링

- 정의
    - 이미 할당된 CPU를 다른 프로세스가 강제로 빼앗아 사용할 수 없는 스케줄링 기법
- 장점
    - 선점 방식에 비해 스케줄러 호출 빈도가 낮으며 오버헤드가 적음
    - 일괄 처리 시스템에 적합
- 단점
    - CPU 사용시간이 긴 하나의 프로세스가 짧은 여러 프로세스를 대기시킬 수 있어 처리율이 떨어질 수 있음
- 종류
    - FCFS (First Come First Served)
        - 준비상태 큐에 도착한 순서에 따라 CPU를 할당하는 기법
    - SJF (Shortest Job First)
        - 실행시간이 가장 짧은 프로세스에 먼저 CPU를 할당하는 기법
        - 짧은 프로세스들이 지속적으로 들어온다면 긴 프로세스는 계속해서 지연되는 단점이 있는데 이러한 상황을 기아상태(Starvation State)
    - HRRN (Highest Response Ratio Next)
        - 실행 시간이 긴 프로세스에 불리한 SJF 기법을 보완하기 위한 것
        - 각 프로세스의 응답률을 계산하여 응답률이 가장 큰 프로세스를 먼저 처리하는 스케줄링 방식
        - 응답률은 (대기시간 +  서비스시간)/서비스시간 으로 구함
        

### 선점 스케줄링

- 정의
    - 하나의 프로세스가 CPU를 할당받아 실행하고 있을 때 우선순위가 높은 프로세스가 CPU를 강제로 빼앗아 사용할 수 있는 스케줄링 기법
- 장점
    - 우선순위가 높은 프로세스를 빠르게 처리해야 할 경우 유용
- 단점
    - 선점이 일어날 경우 오버헤드가 발생하며 처리시간을 예측하기 어려움
- 종류
    - SRT (Shortest Remaining Time)
        - 현재 실행 중인 프로세스의 남은 시간과 대기 큐에 프로세스의 실행시간이 가장 짧은 프로세스에게 CPU를 할당하는 기법
        - 잦은 선점으로 인해 문맥 교환의 부담
    - RR (Round Robin)
        - 시분할 시스템을 위해 고안된 방법으로, 모든 프로세스가 같은 크기의 CPU 시간을 할당 받아서 할당받은 시간(타임 퀀텀) 만큼만 선점하고 시간을 초과하면 다음 프로세스에 할당하는 방식
        - 타임 퀀텀이 작으면 CPU 컨텍스트 스위칭이 자주일어나 오버헤드가 커지고, 타임 퀀텀이 너무 크면 비선점 방식의 FCFS와 다를바 없음
    - 다단계 큐 (Multi-Level Queue)
        - 프로세스를 특정 그룹으로 분류할 수 있는 경우 그룹에 따라 각기 다른 준비 상태 큐를 사용
        - 우선순위가 낮은 큐들이 실행 못하는 것을 방지하고자 각 큐마다 다른 타임 퀀텀을 설정해주는 방식 사용
    - 다단계 피드백 큐 (Multi-Level Feedback Queue)
        - 특정 그룹의 준비상태 큐에 들어간 프로세스가 다른 준비상태 큐로 이동할 수 없는 다단계 큐 기법을 준비상태 큐 사이를 이동할 수 있도록 개선한 기법
        - 새로운 프로세스는 높은 우선순위, 프로세스의 실행이 길어질수록 점점 낮은 우선순위 큐로 이동. 제일 마지막 단계에서는 RR/FCFS 처리
        - 현대 OS에서 RR방식과 함께 가장 많이 사용되는 스케줄링 기법
        

### Critical Section(임계 영역)

- critical section은 한순간에 하나의 프로그램만 접근이 가능한 공유 자원에 접근하는 코드 영역을 의미
- 하나의 프로세스가 critical section 내에 있으면 다른 프로세스들이 접근하지 못하도록 상호 배제를 수행

### 뮤텍스란?

- 상호 배제라고도 하며, 임계 영역을 가진 스레드의 실행 시간이 서로 겹치지 않도록 각각 단독으로 실행하게 하는 기술
- 해당 접근을 조율하기 위해 lock과 unlock을 사용
    - lock : 현재의 임계 구역에 들어갈 권한을 얻어옴, 만일 다른 프로세스/스레드가 임계 구역을 수행 중이라면 종료할때까지 대기
    - unlock : 현재의 임계 구역을 모두 사용했음을 알림. 대기중인 다른 프로세스/스레드가 임계 구역에 진입
- 뮤텍스는 상태가 0,1로 이진 세마포어로 부르기도 함

### 세마포어란?

- 멀티프로그래밍 환경에서 공유 자원에 대한 접근을 제한하는 방법으로 프로세스 진입여부를 자원의 개수를 통해 결정
- 세마포어 S는 정수값을 가지는 변수이며, 다음과 같이 P와 V라는 명령에 의해서만 접근
    - P : 임계구역 들어가기 전에 수행 (프로세스 진입 여부를 자원의 개수 S를 통해 결정)
    - V : 임계구역에서 나올 때 수행 (자원 반납 알림, 대기중인 프로세스를 깨우는 신호)
    

### 데드락 (교착상태)

- 둘 이상의 프로세스들이 자원을 점유한 상태에서 서로 다른 프로세스가 점유하고 있는 자원을 요구하며 무한정 기다리는 상황

### 데드락 발생조건

- 4가지 조건이 모두 성립해야 데드락 발생, 하나라도 성립하지 않는다면 데드락 문제를 해결 가능
    1. 비선점 (Nonpreemptive) : 다른 프로세스의 자원을 뺏을 수 없음.
    2. 순환 대기 (Circular wait) : 두 개 이상의 프로세스가 자원 접근을 기다릴 때, 관계가 순환적 구조.
    3. 점유 대기 (Hold & Wait) : 공유 자원에 대한 접근 권한을 가진 채로 다른 자원에 대한 접근 권한을 요구.
    4. 상호 배제(Mutual Exclusion) : 한 번에 한 프로세스만 공유 자원에 접근 가능하며, 접근 권한이 제한적일 경우.
    

### 데드락 해결방법

- 데드락이 발생하지 않도록 예방하기
- 데드락 발생 가능성을 인정하면서도 적절하게 회피하기
- 데드락 발생을 허용하지만 데드락을 탐지하여, 데드락에서 회복하기

### 데드락 예방

- 데드락의 발생조건 4가지 중 하나라도 발생하지 않게 하는 것이 데드락을 예방하는 방법
- 각각의 조건을 방지(부정)하여 데드락 발생 가능성을 차단
- 조건을 방지해서 예방하는 방법은 시스템의 처리량이나 효율성을 떨어뜨리는 단점이 발생할 수 있음

### 데드락 회피

- 회피 알고리즘은 자원을 할당한 후에도 시스템이 항상 Safe state에 있을 수 있도록 할당을 허용하자는 것이 기본 특징
- 이러한 특징을 살린 알고리즘이 은행원 알고리즘

### 은행원 알고리즘

- 다익스트라가 제안한 기법으로, 어떤 자원의 할당을 허용하는지에 관한 여부를 결정하기 전에, 미리 결정된 모든 자원들의 최대 가능한 할당량을 가지고 시뮬레이션해서 Safe state에 들 수 있는지 여부를 검사
- 

### 데드락 탐지/회복
